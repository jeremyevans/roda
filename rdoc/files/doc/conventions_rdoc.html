<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>conventions.rdoc</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>conventions.rdoc
</h1>
<div class='paths'>
doc/conventions.rdoc
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-Conventions">Conventions<span><a href="#label-Conventions">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>This guide goes over conventions for directory layout and file layout for <a href="../../classes/Roda.html"><code>Roda</code></a> applications. You are free to ignore these conventions, they mostly exist to help users who are unsure how to structure their <a href="../../classes/Roda.html"><code>Roda</code></a> applications.</p>

<h2 id="label-Directory+Layout">Directory Layout<span><a href="#label-Directory+Layout">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Which directory layout to use should reflect the size of your application.</p>

<h3 id="label-Small+Applications">Small Applications<span><a href="#label-Small+Applications">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>For a small application, the following directory layout is recommended:</p>

<pre>Rakefile
app_name.rb
assets/
config.ru
db.rb
migrate/
models.rb
models/
public/
spec/
views/</pre>

<p><code>app_name.rb</code> should contain the <a href="../../classes/Roda.html"><code>Roda</code></a> application, and should reflect the name of your application. So, if your application is named <code>FooBar</code>, you should use <code>foo_bar.rb</code>.</p>

<p><code>config.ru</code> should contain the code the webserver uses to determine which application to run.</p>

<p><code>views/</code> should contain your template files.  This assumes you are using the <code>render</code> plugin and server-side rendering.  If you are creating a single page application and just serving JSON, then you won’t need a <code>views</code> directory.  For small applications, all view files should be in the <code>views</code> directory.</p>

<p><code>public/</code> should contain any static files that should be served directly by the webserver. Again, for pure JSON applications, you won’t need a <code>public</code> directory.</p>

<p><code>assets/</code> should contain the source files for your CSS and javascript assets.  If you are not using the <code>assets</code> plugin, you won’t need an <code>assets</code> directory.</p>

<p><code>db.rb</code> should contain the minimum code to setup a database connection, without loading any of the applications models.  This can be required in cases where you don’t want the models loaded, such as when running migrations. This file should be required by <code>models.rb</code>.</p>

<p><code>models.rb</code> should contain all code related to your ORM.  This file should be required by <code>app_name.rb</code>.  This keeps your model code separate from your web code, making it easier to use outside of your web code. It allows you to get an IRB shell for accessing your models via <code>irb -r ./models</code>, without loading the <a href="../../classes/Roda.html"><code>Roda</code></a> application.</p>

<p><code>models/</code> should contain your ORM models, with a separate file per model class.</p>

<p><code>migrate/</code> should create your database migration files, if you are using an ORM that uses migrations.</p>

<p><code>spec/</code> (or <code>test/</code> should contain your specifications/tests.  For a small application, it’s recommended to have a single file for your model tests, and a single file for your web/integration tests.</p>

<p><code>Rakefile</code> should contain the rake tasks for the application.  The convention is that the default rake task will run all specs/tests related to the application.  If you are using the <code>assets</code> plugin, you should have an <code>assets:precompile</code> task for precompiling assets.</p>

<h3 id="label-Large+Applications">Large Applications<span><a href="#label-Large+Applications">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Large applications generally need more structure:</p>

<pre>Rakefile
app_name.rb
assets/
helpers/
migrate/
models.rb
models/
public/
routes/
 prefix1.rb
 prefix2.rb
spec/
 models/
 web/
views/
 prefix1/
 prefix2/</pre>

<p>For larger apps, the <code>Rakefile</code>, <code>assets/</code>, <code>migrate</code>, <code>models.rb</code>, <code>models/</code>, <code>public/</code>, remain the same.</p>

<p><code>app_name.rb</code> should use the <code>hash_branch_view_subdir</code> plugin (which builds on the <code>hash_branches</code> and <code>view_options</code> plugin), or the <code>multi_run</code> plugin. The routes used by the <code>hash_branches</code> or <code>multi_run</code> should be stored in routing files in the <code>routes/</code> directory, with one file per prefix.</p>

<p>For specs/tests, you should have <code>spec/models/</code> and <code>spec/web/</code>, with one file per model in <code>spec/models/</code> and one file per prefix in <code>spec/web/</code>. Substitute <code>spec</code> with <code>test</code> if that is what you are using as the name of the directory.</p>

<p>You should have a separate view subdirectory per prefix. With the <code>hash_branch_view_subdir</code>, the application will automatically set a separate view subdirectory per routing tree branch.</p>

<p><code>helpers/</code> should be used to store helper methods for your application, that you call in your routing files and views.  In a small application, these methods should just be specified in <code>app_name.rb</code></p>

<h3 id="label-Really+Large+Applications">Really Large Applications<span><a href="#label-Really+Large+Applications">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>For very large applications, it’s expected that there will be deviations from these conventions. However, it is recommended to use the <code>hash_branch_view_subdir</code> or <code>multi_run</code> plugins to organize your application, and have subdirectories in the <code>routes/</code> directory, and nested subdirectories in the <code>views/</code> directory.</p>

<h2 id="label-Roda+Application+File+Layout"><a href="../../classes/Roda.html"><code>Roda</code></a> Application File Layout<span><a href="#label-Roda+Application+File+Layout">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h3 id="label-Small+Applications">Small Applications<span><a href="#label-Small+Applications">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>For a small application, the convention in <a href="../../classes/Roda.html"><code>Roda</code></a> is to layout your <a href="../../classes/Roda.html"><code>Roda</code></a> application file (<code>app_name.rb</code>) like this:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;roda&#39;</span>
<span class="ruby-identifier">require_relative</span> <span class="ruby-string">&#39;models&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">AppName</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-constant">SOME_CONSTANT</span> = <span class="ruby-value">1</span>

  <span class="ruby-identifier">use</span> <span class="ruby-constant">SomeMiddleware</span>

  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>, <span class="ruby-value">escape:</span> <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:assets</span>

  <span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># ...</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">view_method</span>
    <span class="ruby-string">&#39;foo&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You should first require <code>roda</code> and <code>./models</code>, followed by any other libraries needed by the application.</p>

<p>You should subclass <a href="../../classes/Roda.html"><code>Roda</code></a> and make the application’s name the name of the <a href="../../classes/Roda.html"><code>Roda</code></a> subclass. Inside the subclass, you first define the constants used by the application.  Then you add any middleware used by the application, followed by loading any plugins used by the application. Then you add the route block for the application.  After the route block, define the instance methods used in your route block or views.</p>

<h3 id="label-Large+Applications">Large Applications<span><a href="#label-Large+Applications">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>For larger applications, there are some slight changes to the <a href="../../classes/Roda.html"><code>Roda</code></a> application file layout:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;roda&#39;</span>
<span class="ruby-identifier">require_relative</span> <span class="ruby-string">&#39;models&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">AppName</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-constant">SOME_CONSTANT</span> = <span class="ruby-value">1</span>

  <span class="ruby-identifier">use</span> <span class="ruby-constant">SomeMiddleware</span>

  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:render</span>, <span class="ruby-value">escape:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">layout:</span> <span class="ruby-string">&#39;./layout&#39;</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:assets</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:hash_branch_view_subdir</span>
  <span class="ruby-constant">Dir</span>[<span class="ruby-string">&#39;routes/*.rb&#39;</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">require_relative</span> <span class="ruby-identifier">f</span>}

  <span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">hash_branches</span>(<span class="ruby-string">&#39;&#39;</span>)

    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">root</span> <span class="ruby-keyword">do</span>
      <span class="ruby-comment"># ...</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Dir</span>[<span class="ruby-string">&#39;helpers/*.rb&#39;</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">require_relative</span> <span class="ruby-identifier">f</span>}
<span class="ruby-keyword">end</span>
</pre>

<p>After loading the <code>hash_branch_view_subdir</code> plugin, you require all of your routing files.  Inside your route block, instead of defining your routes, you just call <code>r.hash_branches</code>, which will dispatch to all of your routing files.  After your route block, you require all of your helper files containing the instance methods for your route block or views, instead of defining the methods directly.</p>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>2.1.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>2.1.0.txt
</h1>
<div class='paths'>
doc/release_notes/2.1.0.txt
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Plugins">New Plugins<span><a href="#label-New+Plugins">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>A view_options plugin has been added, for branch/route specific setting of view and layout options and locals.  This allows for DRYer code when you want to change the view or layout settings for an entire routing branch.  Options and locals set at the branch or route level have higher priority than those set at the plugin level, but lower priority than those provided as arguments to the render/view methods. Example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:view_options</span>

  <span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">on</span> <span class="ruby-string">&#39;albums&#39;</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">layout_options</span> <span class="ruby-value">:template</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;layouts/3_columns&#39;</span>
      <span class="ruby-identifier">layout_locals</span> <span class="ruby-value">:heading</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;Albums&#39;</span>
      <span class="ruby-identifier">view_options</span> <span class="ruby-value">:ext</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;haml&#39;</span>
      <span class="ruby-identifier">view_locals</span> <span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;Foo&#39;</span>
      <span class="ruby-comment"># ...</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The view_options plugin is also a superset of the previous view_subdirs plugin, and attempts to load view_subdirs will now load view_options.  In addition to set_view_subdir, the view_options plugin now supports append_view_subdir, which will append a subdirectory to an existing subdirectory, which makes it simpler to deal with nested view file hierarchies.</p>
</li><li>
<p>A static plugin has been added for easily serving static files using Rack::Static.  Example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:static</span>, [<span class="ruby-string">&#39;/js&#39;</span>, <span class="ruby-string">&#39;/css&#39;</span>]
  <span class="ruby-comment"># or:</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:static</span>, [<span class="ruby-string">&#39;/js&#39;</span>, <span class="ruby-string">&#39;/css&#39;</span>], <span class="ruby-value">:root</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;pub&#39;</span>
<span class="ruby-keyword">end</span>
</pre>
</li></ul>

<h1 id="label-Other+New+Features">Other New Features<span><a href="#label-Other+New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p><a href="../../../classes/Roda.html"><code>Roda</code></a> now supports a :root option for the application that sets the root directory.  This is useful if the application’s files are not stored in the process’s working directory, which is common for processes containing of multiple <a href="../../../classes/Roda.html"><code>Roda</code></a> applications.</p>

<p>By setting the :root option, plugins that use the file system will default to making relative paths relative to the :root option instead of the process’s working directory.  The assets, render, and static plugins currently support the :root option.  Example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:root</span>] = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>)
<span class="ruby-keyword">end</span>
</pre>
</li><li>
<p><a href="../../../classes/Roda.html"><code>Roda</code></a> now supports an :add_script_name option for the application, which makes plugins automatically prepend the SCRIPT_NAME for the request’s environment to any paths created.  This allows <a href="../../../classes/Roda.html"><code>Roda</code></a> applications to work transparently whenever they are mounted inside of another rack application.</p>

<p>The assets and path plugins currently recognize the :add_script_name option.  Example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:add_script_name</span>] = <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>
</pre>
</li><li>
<p>The path plugin now adds a Roda#path method, which creates paths based on the type of argument used.  You can register classes with the path plugin by providing Roda.path with a class, which will cause Roda#path to recognize them and handle them accordingly.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:path</span>
  <span class="ruby-identifier">path</span>(<span class="ruby-constant">Track</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">track</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;/albums/#{track.album_id}/tracks/#{track.number}&quot;</span>}

  <span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">r</span>.<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;tracks/:id&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">track_id</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">r</span>.<span class="ruby-identifier">redirect</span>(<span class="ruby-identifier">path</span>(<span class="ruby-constant">Track</span>[<span class="ruby-identifier">track_id</span>]))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>add_file in the mailer plugin now adds the files after the email body instead of before.  This fixes some issues where the email body would end up empty, due to issues with the mail gem’s API.</p>

<p>add_file now accepts a block, and the block is called after the file has been attached.  Among other things, this allows you to change the content_type for an attached file:</p>

<pre class="ruby"><span class="ruby-identifier">add_file</span> <span class="ruby-string">&#39;path/to/file&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">response</span>.<span class="ruby-identifier">mail</span>.<span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-string">&#39;text/foo&#39;</span>
<span class="ruby-keyword">end</span>
</pre>
</li><li>
<p>r.multi_route in the multi_route plugin now works if there are no named routes defined.</p>
</li><li>
<p>A render plugin :locals option is now respected, setting defaults to use for locals in views.  Additionally, a :locals option in the :layout_opts option is now respected for setting locals in layouts.  If both the render plugin option is set and :locals is passed to render/view, the two will be merged together. Previously, providing a :locals option to render/view would cause the plugin level option to be ignored.</p>
</li></ul>

<h1 id="label-Backwards+Compatibility">Backwards Compatibility<span><a href="#label-Backwards+Compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Using the render plugin :layout=&gt;nil option now removes any layout template set previously using :layout.  Previously, the layout template would still be kept, but it would not be used by default.</p>
</li><li>
<p>Accessing attachments after adding a file using add_file in the mailer plugin no longer works, as the adding is now delayed until after the body is set.  You should now pass a block to add_file if you want to access the attachment after it has been added.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>

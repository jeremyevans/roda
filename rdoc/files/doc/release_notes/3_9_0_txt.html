<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>3.9.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>3.9.0.txt
</h1>
<div class='paths'>
doc/release_notes/3.9.0.txt
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>A route_csrf plugin has been added.  This plugin allows for more control over CSRF protection, since the user can choose where in the routing tree to enforce the protection.  Additionally, the route_csrf plugin offers better security than the CSRF protection used by the csrf plugin (which uses the rack_csrf library).</p>

<p>The route_csrf plugin defaults to allowing only CSRF tokens specific to a given request method and request path, and not allowing generic CSRF tokens (though it does offer optional support for such tokens).  Both request-specific and generic CSRF tokens are designed to never leak the CSRF secret key, making it more difficult to forge valid CSRF tokens.  Additionally, the plugin offers optional support for accepting rack_csrf tokens, which should only be enabled during a short transition period.</p>

<p>Some differences between the route_csrf plugin and the older csrf plugin:</p>
<ul><li>
<p>route_csrf supports and by default only allows CSRF tokens specific to request method and request path, as mentioned above.  You can use the require_request_specific_tokens: false option to allow generic CSRF tokens.</p>
</li><li>
<p>route_csrf does not check the HTTP header by default, it only checks the header if the :check_header option is set. The :check_header option can be set to true to check both the parameter and the header, or set to :only to only check the header.</p>
</li><li>
<p>route_csrf raises by default for invalid CSRF tokens.  rack_csrf returns an empty 403 response in that case.  You can use the error_handler plugin to handle the <a href="../../../classes/Roda/RodaPlugins/RouteCsrf/InvalidToken.html"><code>Roda::RodaPlugins::RouteCsrf::InvalidToken</code></a> exceptions, or you can use the csrf_failure: :empty_403 option if you would like the csrf plugin default behavior.  The plugin also accepts a block for configurable failure behavior.</p>
</li><li>
<p>route_csrf does not use a middleware, as it is designed to give more control. In order to enforce the CSRF protection, you need to call check_csrf! in your routing tree at the appropriate place.  If you are not sure where to add it, add it to the top of the routing tree, after the public or assets routes if you are using those plugins:</p>

<pre class="ruby"><span class="ruby-identifier">route</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">public</span>
  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">assets</span>
  <span class="ruby-identifier">check_csrf!</span>

  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The check_csrf! method accepts an options hash, which can be used to override the plugin options on a per-call basis.</p>
</li><li>
<p>The csrf_token/csrf_tag methods take an optional path and method arguments.  If a path is given, the method defaults to POST, and the resulting CSRF token can only be used to submit forms for the path and method.  If a path is not given, the resulting CSRF token will be generic, but it will only work if the plugin has been configured to allow generic CSRF tokens.</p>
</li><li>
<p>A csrf_path method is available for easily taking a form action string and returning an appropriate path to pass to the csrf_token or csrf_tag methods.</p>
</li></ul>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>

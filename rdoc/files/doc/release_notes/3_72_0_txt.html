<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>3.72.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>3.72.0.txt
</h1>
<div class='paths'>
doc/release_notes/3.72.0.txt
</div>
<div class='last-update'>
Last Update:
<span class='datetime'>2023-09-12 10:34:26 -0700</span>
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>An invalid_request_body plugin has been added for allowing custom handling of invalid request bodies.  <a href="../../../classes/Roda.html"><code>Roda</code></a> uses Rack’s request body parsing, and by default invalid request bodies can result in different exceptions based on how the body is invalid and which version of Rack is in use.</p>

<p>If you want to treat an invalid request body as the submission of no parameters, you can use the :empty_hash argument when loading the plugin:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:invalid_request_body</span>, <span class="ruby-value">:empty_hash</span>
</pre>

<p>If you want to return a empty 400 (Bad Request) response if an invalid request body is submitted, you can use the :empty_400 argument when loading the plugin:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:invalid_request_body</span>, <span class="ruby-value">:empty_400</span>
</pre>

<p>If you want to raise a Roda::RodaPlugins::InvalidRequestBody::Error exception if an invalid request body is submitted (which makes it easier to handle these exceptions when using the error_handler plugin), you can use the :raise argument when loading the plugin:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:invalid_request_body</span>, <span class="ruby-value">:raise</span>
</pre>

<p>For custom behavior, you can pass a block when loading the plugin The block is called with the exception Rack raised when parsing the body. The block will be used to define a method in the application’s RodaRequest class.  It can either return a hash of parameters, or you can raise a different exception, or you can halt processing and return a response:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:invalid_request_body</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">exception</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># To treat the exception raised as a submitted parameter</span>
  {<span class="ruby-value">body_error:</span> <span class="ruby-identifier">exception</span>}
<span class="ruby-keyword">end</span>
</pre>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>When using the check_arity: :warn <a href="../../../classes/Roda.html"><code>Roda</code></a> option, <a href="../../../classes/Roda.html"><code>Roda</code></a> now correctly warns when defining a method that expects a single argument when the provided block requires multiple arguments.</p>
</li><li>
<p>The match_hooks plugin is now implemented using the match_hook_args plugin, simplifying the implementation.  This change should be transparent unless you were reaching into the internals.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head>
<title>2.24.0.txt</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
<link href='../../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/javascript'>
  function popupCode(url) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }
  
  function toggleCode(id) {
    var code = document.getElementById(id)
  
    code.style.display = code.style.display != 'block' ? 'block' : 'none'
    return true
  }
  
  // Make codeblocks hidden by default
  document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
</script>
</head>
<body class='page'>
<div class='file' id='wrapper'>
<div class='header'>
<h1 class='name'>2.24.0.txt
</h1>
<div class='paths'>
doc/release_notes/2.24.0.txt
</div>
</div>
<div id='content'>
<div id='text'>
<div id='description'>
<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The middleware plugin now accepts a block that can be used to implement configurable middleware.  This allows you to load the <a href="../../../classes/Roda.html"><code>Roda</code></a> application as middleware in another application, and provide options/block that are passed to the block you passed when loading the middleware plugin.  Example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Mid</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:middleware</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">middleware</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">middleware</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:middleware_args</span>] = <span class="ruby-identifier">args</span>
    <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">middleware</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">App</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Roda</span>
  <span class="ruby-identifier">use</span> <span class="ruby-constant">Mid</span>, <span class="ruby-value">:foo</span>, <span class="ruby-value">:bar</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">middleware</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">middleware</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:middleware_args</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:baz</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note that when passing a block when loading the middleware plugin, using the middleware in another rack application will actually load a subclass of the middleware (Mid in the example above). This allows you to use the <a href="../../../classes/Roda.html"><code>Roda</code></a> middleware multiple times in the same process with different configurations.</p>
</li><li>
<p>The cookies plugin now accepts options that are used as the default options when setting and deleting cookies:</p>

<pre class="ruby"><span class="ruby-identifier">plugin</span> <span class="ruby-value">:cookies</span>, <span class="ruby-value">:path</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;/foo&#39;</span>, <span class="ruby-value">:domain</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;example.com&#39;</span>
</pre>
</li><li>
<p>A strip_path_prefix plugin has been added, which can be used to strip prefixes from internal paths.  Internally Sequel stores most paths as absolute paths, but there are cases where this doesn’t work well, such as symlink changes and chroot.  This plugin supports those scenarios.</p>
</li><li>
<p>A disallow_file_uploads plugin has been added, which raises an exception if the user attempts a multipart file upload. More exactly, it makes the application raise an exception if attempting to parse a request body when the user has submitted a multipart file upload.  This is useful if you don’t need to support file uploads in your application, or cases where no paths are writable by the application (due to chroot or system call filtering).</p>
</li><li>
<p>The :freeze_middleware option has been added, which freezes all middleware instances when building the rack application.  This can help find thread safety issues in middleware.</p>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The h plugin is now about 6x faster on ruby 2.3+ due to the use of cgi/escape.</p>
</li><li>
<p>The static_routing plugin now works with the hooks plugin if the hooks plugin is loaded first.</p>
</li><li>
<p>The render plugin’s render cache is no longer cleared when loading the plugin multiple times.</p>
</li></ul>

<h1 id="label-Backwards+Compatibility">Backwards Compatibility<span><a href="#label-Backwards+Compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The h plugin now escapes ‘ as &amp;#39; instead of &amp;#x27;.</p>
</li></ul>
</div>
<div id='context'>
</div>

</div>
</div>

<div id='footer-push'></div>
</div>
<div id='footer'>
<a href="https://github.com/jeremyevans/hanna"><strong>Hanna</strong> RDoc template</a>
</div>
</body>
</html>
